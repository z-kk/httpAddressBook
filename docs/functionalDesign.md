# 基本設計書

## サーバプログラム

### 起動

- 設定ファイルが存在するか確認する
- 設定ファイルがなければ情報の入力を求める
- 設定ファイルがあれば必須項目の抜けがないか確認し, 抜けがあればその情報の入力を求める
- 設定ファイルにパスワードの設定がなければDB名, ユーザ名を表示し, パスワードの入力を求める
- DBに接続できるか確認する
- 接続できなければエラーを表示してプログラムを終了する
- 接続できればHTTPサーバを起動する

### トップ画面要求

- 各画面へのリンクがある画面を返す

### 住所録一覧画面要求

- 検索条件をパラメータで受け取る
- 検索条件にあうデータを取得する
- 検索欄, 表示項目選択チェックボックス, 検索結果データ一覧がある画面を返す

### データ編集画面要求

- データIDをパラメータで受け取る
    - データIDを受け取れなかった場合は住所録一覧画面を返す
- データIDに一致するデータを取得する
    - データがなければ一致するデータがないことを示すページを返す
- 対象のデータを書き換えるための画面を返す

### データ編集要求

- データ編集に必要なデータをパラメータで受け取る
- 受け取ったパラメータをもとにデータを更新する
- 更新に失敗した場合, 失敗したことを示すページを返す
- 更新に成功した場合, 成功したことを示すページを返す
    - 更新後のデータも表示する
- 返すページには住所録一覧画面へのリンクを表示する

### 授受記録登録画面要求

- 授受物の種類, 受信/送信, 日付, 対象年 をパラメータで受け取る
- パラメータに存在しないものは初期値を設定する
- 登録対象候補のデータを取得する
    - 種類, 受信/送信, 対象年 が同じものは省く
    - 受信なら 種類, 対象年 が同じデータがあるものが先
    - 送信, 年賀状なら 年賀状を送るデータが先
- 登録対象を選択する画面を返す

### 授受記録登録要求

- 授受物の種類, 受信/送信, 日付, 対象年, 対象ID をパラメータで受け取る
- 授受記録データに登録する
- 登録に失敗したデータがある場合, 登録に失敗したデータが存在することを示すページを返す
- 登録に失敗したデータがなければ登録に成功したことを示すページを返す
- 返すページには登録に成功したデータ, 失敗したデータ, 授受記録表示画面へのリンク を表示する

### 授受記録表示画面要求

- 表示する期間[年]をパラメータで受け取る
- 期間の初期値は5年
- 期間内に授受記録があるデータのみ取得する
- 登録されているデータID 1つにつき1行の表にしたページを返す

### CSV作成要求

- 年賀状を送る対象のデータのみ取得する
- データID, 氏名, 住所, 3年以内の年賀状, 喪中はがきの受信記録をグループ毎に区切ったCSVにして返す

### 設定変更画面要求

設定変更項目

- HTTPサーバ起動ポート
- DBの種類
- DBのホスト名(IPアドレス)
- DBのユーザ名
- DBのパスワード(空可)

を入力させる項目とOKボタンを表示する画面を返す

OKボタン押下時は画面遷移せずに設定変更要求を呼ぶ

### 設定変更要求

- 設定変更画面で入力した値をパラメータで受け取る
- 設定ファイルの内容を上書きする
- ファイルの上書きに成功したかどうかを文字列で返す

## HTML, JavaScript
